<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0050)http://www.sql.co.il/books/advtsql/corrections.htm -->
<HTML><HEAD><TITLE>Corrections</TITLE>
<META http-equiv=Content-Language content=en-us>
<META content="MSHTML 6.00.2800.1141" name=GENERATOR>
<META content=FrontPage.Editor.Document name=ProgId>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<STYLE>.bt2 {
	FONT-SIZE: 10pt; FONT-FAMILY: 'verdana',sans-serif
}
</STYLE>

<META content="zero-bg-2 110, default" name="Microsoft Theme">
<META content="tlb, default" name="Microsoft Border"></HEAD>
<BODY text=#ffffff vLink=#6699cc aLink=#999999 link=#669966 bgColor=#323264><!--msnavigation-->
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD><!--mstheme--><FONT face=Verdana>
      <P><IMG height=60 alt=Corrections src="" width=580 border=0> 
<BR>&nbsp;</P><!--mstheme--></FONT></TD></TR><!--msnavigation--></TBODY></TABLE><!--msnavigation-->
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD vAlign=top width="1%"><!--mstheme--><FONT face=Verdana>
      <P>
      <SCRIPT language=JavaScript><!--
MSFPhover = 
  (((navigator.appName == "Netscape") && 
  (parseInt(navigator.appVersion) >= 3 )) || 
  ((navigator.appName == "Microsoft Internet Explorer") && 
  (parseInt(navigator.appVersion) >= 4 ))); 
function MSFPpreload(img) 
{
  var a=new Image(); a.src=img; return a; 
}
// --></SCRIPT>

      <SCRIPT language=JavaScript><!--
if(MSFPhover) { MSFPnav1n=MSFPpreload("../../_derived/home_cmp_zero-bg-2110_vbtn.gif"); MSFPnav1h=MSFPpreload("../../_derived/home_cmp_zero-bg-2110_vbtn_a.gif"); }
// --></SCRIPT>
      <A language=JavaScript 
      onmouseover="if(MSFPhover) document['MSFPnav1'].src=MSFPnav1h.src" 
      onmouseout="if(MSFPhover) document['MSFPnav1'].src=MSFPnav1n.src" 
      href="http://www.sql.co.il/"><IMG height=60 alt=Home 
      src="Corrections ben gan moreau_files/home_cmp_zero-bg-2110_vbtn.gif" 
      width=140 border=0 name=MSFPnav1></A><BR>
      <SCRIPT language=JavaScript><!--
if(MSFPhover) { MSFPnav2n=MSFPpreload("../../_derived/about.htm_cmp_zero-bg-2110_vbtn.gif"); MSFPnav2h=MSFPpreload("../../_derived/about.htm_cmp_zero-bg-2110_vbtn_a.gif"); }
// --></SCRIPT>
      <A language=JavaScript 
      onmouseover="if(MSFPhover) document['MSFPnav2'].src=MSFPnav2h.src" 
      onmouseout="if(MSFPhover) document['MSFPnav2'].src=MSFPnav2n.src" 
      href="http://www.sql.co.il/about.htm"><IMG height=60 alt=About 
      src="Corrections ben gan moreau_files/about.htm_cmp_zero-bg-2110_vbtn.gif" 
      width=140 border=0 name=MSFPnav2></A><BR>
      <SCRIPT language=JavaScript><!--
if(MSFPhover) { MSFPnav3n=MSFPpreload("../../_derived/ext1002_cmp_zero-bg-2110_vbtn.gif"); MSFPnav3h=MSFPpreload("../../_derived/ext1002_cmp_zero-bg-2110_vbtn_a.gif"); }
// --></SCRIPT>
      <A language=JavaScript 
      onmouseover="if(MSFPhover) document['MSFPnav3'].src=MSFPnav3h.src" 
      onmouseout="if(MSFPhover) document['MSFPnav3'].src=MSFPnav3n.src" 
      href="http://www.solidqualitylearning.com/"><IMG height=60 
      alt=SolidQualityLearning 
      src="Corrections ben gan moreau_files/ext1002_cmp_zero-bg-2110_vbtn.gif" 
      width=140 border=0 name=MSFPnav3></A><BR>
      <SCRIPT language=JavaScript><!--
if(MSFPhover) { MSFPnav4n=MSFPpreload("../../_derived/schedule.htm_cmp_zero-bg-2110_vbtn.gif"); MSFPnav4h=MSFPpreload("../../_derived/schedule.htm_cmp_zero-bg-2110_vbtn_a.gif"); }
// --></SCRIPT>
      <A language=JavaScript 
      onmouseover="if(MSFPhover) document['MSFPnav4'].src=MSFPnav4h.src" 
      onmouseout="if(MSFPhover) document['MSFPnav4'].src=MSFPnav4n.src" 
      href="http://www.sql.co.il/schedule.htm"><IMG height=60 alt=Schedule 
      src="Corrections ben gan moreau_files/schedule.htm_cmp_zero-bg-2110_vbtn.gif" 
      width=140 border=0 name=MSFPnav4></A><BR>
      <SCRIPT language=JavaScript><!--
if(MSFPhover) { MSFPnav5n=MSFPpreload("../../_derived/magazines.htm_cmp_zero-bg-2110_vbtn.gif"); MSFPnav5h=MSFPpreload("../../_derived/magazines.htm_cmp_zero-bg-2110_vbtn_a.gif"); }
// --></SCRIPT>
      <A language=JavaScript 
      onmouseover="if(MSFPhover) document['MSFPnav5'].src=MSFPnav5h.src" 
      onmouseout="if(MSFPhover) document['MSFPnav5'].src=MSFPnav5n.src" 
      href="http://www.sql.co.il/magazines.htm"><IMG height=60 alt=Magazines 
      src="Corrections ben gan moreau_files/magazines.htm_cmp_zero-bg-2110_vbtn.gif" 
      width=140 border=0 name=MSFPnav5></A><BR>
      <SCRIPT language=JavaScript><!--
if(MSFPhover) { MSFPnav6n=MSFPpreload("_derived/Advanced T-SQL for SQL Server 2000.htm_cmp_zero-bg-2110_vbtn.gif"); MSFPnav6h=MSFPpreload("_derived/Advanced T-SQL for SQL Server 2000.htm_cmp_zero-bg-2110_vbtn_a.gif"); }
// --></SCRIPT>
      <A language=JavaScript 
      onmouseover="if(MSFPhover) document['MSFPnav6'].src=MSFPnav6h.src" 
      onmouseout="if(MSFPhover) document['MSFPnav6'].src=MSFPnav6n.src" 
      href="http://www.sql.co.il/books/advtsql/Advanced%20T-SQL%20for%20SQL%20Server%202000.htm"><IMG 
      height=60 alt="T-SQL Book" 
      src="Corrections ben gan moreau_files/Advanced%20T-SQL%20for%20SQL%20Server%202000.htm_cmp_zero-bg-2110_vbtn.gif" 
      width=140 border=0 name=MSFPnav6></A><BR>
      <SCRIPT language=JavaScript><!--
if(MSFPhover) { MSFPnav7n=MSFPpreload("../../ug/_derived/index.htm_cmp_zero-bg-2110_vbtn.gif"); MSFPnav7h=MSFPpreload("../../ug/_derived/index.htm_cmp_zero-bg-2110_vbtn_a.gif"); }
// --></SCRIPT>
      <A language=JavaScript 
      onmouseover="if(MSFPhover) document['MSFPnav7'].src=MSFPnav7h.src" 
      onmouseout="if(MSFPhover) document['MSFPnav7'].src=MSFPnav7n.src" 
      href="http://www.sql.co.il/ug/index.htm"><IMG height=60 
      alt="ISQL Users Group" 
      src="Corrections ben gan moreau_files/index.htm_cmp_zero-bg-2110_vbtn.gif" 
      width=140 border=0 name=MSFPnav7></A><BR>
      <SCRIPT language=JavaScript><!--
if(MSFPhover) { MSFPnav8n=MSFPpreload("../../resources/_derived/resources.htm_cmp_zero-bg-2110_vbtn.gif"); MSFPnav8h=MSFPpreload("../../resources/_derived/resources.htm_cmp_zero-bg-2110_vbtn_a.gif"); }
// --></SCRIPT>
      <A language=JavaScript 
      onmouseover="if(MSFPhover) document['MSFPnav8'].src=MSFPnav8h.src" 
      onmouseout="if(MSFPhover) document['MSFPnav8'].src=MSFPnav8n.src" 
      href="http://www.sql.co.il/resources/resources.htm"><IMG height=60 
      alt=Resources 
      src="Corrections ben gan moreau_files/resources.htm_cmp_zero-bg-2110_vbtn.gif" 
      width=140 border=0 name=MSFPnav8></A> </P><!--mstheme--></FONT></TD>
    <TD vAlign=top width=24></TD><!--msnavigation-->
    <TD vAlign=top><!--mstheme--><FONT face=Verdana><SPAN class=bt2><!--msthemeseparator-->
      <P align=center><IMG height=10 
      src="Corrections ben gan moreau_files/zerrulea.gif" width=600></P>
      <P align=left><I><FONT face=Arial color=#639ace size=3><B>Advanced 
      Transact-SQL for SQL Server 2000</B></FONT></I></P>
      <H3 align=left><!--mstheme--><FONT color=#6699cc>Chapter 
      1<!--mstheme--></FONT></H3>
      <H4 align=left><!--mstheme--><FONT 
      color=#6699cc>General<!--mstheme--></FONT></H4>
      <P align=left>The "Advantage" boxes in pages: 12, 13, 18, 21, 28, are 
      mistakenly numbered from 8 and on, instead if being numbered from 1 and 
      on. </P>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Pages 
      22-24<!--mstheme--></FONT></H4>
      <P align=left>In the steps that explain the result shown in Table 1-14 of 
      the query shown in Listing 1-25, Input1 refers to the Employees table and 
      Input2 refers to the Departments table. Instead, Input1 should refer to 
      the Departments table and Input2 should refer to the Employees table. The 
      correct steps are: </P><!--mstheme--></FONT><!--msthemelist-->
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0><!--msthemelist-->
        <TBODY>
        <TR>
          <TD vAlign=baseline width=42><IMG height=15 hspace=13 
            src="Corrections ben gan moreau_files/zerbul1a.gif" width=15></TD>
          <TD vAlign=top width="100%"><!--mstheme--><FONT face=Verdana>
            <P align=left>Step 1. Let Input1 = all rows from Departments. </P>
            <P align=left>&nbsp;</P><!--mstheme--></FONT>
            <TABLE borderColorDark=#666666 borderColorLight=#cccccc border=1>
              <TBODY>
              <TR>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptno<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptname<!--mstheme--></FONT></P></TH></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>100<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Engineering<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>200<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Production<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>300<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Sanitation<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>400<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P 
            align=left>Management<!--mstheme--></FONT></P></TD></TR></TBODY></TABLE><!--mstheme--><FONT 
            face=Verdana>
            <P 
align=left>&nbsp;<!--mstheme--></FONT><!--msthemelist--></P></TD></TR><!--msthemelist-->
        <TR>
          <TD vAlign=baseline width=42><IMG height=15 hspace=13 
            src="Corrections ben gan moreau_files/zerbul1a.gif" width=15></TD>
          <TD vAlign=top width="100%"><!--mstheme--><FONT face=Verdana>
            <P align=left>Step 2. Let Input2 = all rows from Employees WHERE 
            deptno IS NULL. </P>
            <P align=left>&nbsp;</P><!--mstheme--></FONT>
            <TABLE borderColorDark=#666666 borderColorLight=#cccccc border=1>
              <TBODY>
              <TR>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>empid<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>empname<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptno<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>jobid<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>salary<!--mstheme--></FONT></P></TH></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>6<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Jeffrey<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>30<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P 
            align=left>5000.00<!--mstheme--></FONT></P></TD></TR></TBODY></TABLE><!--mstheme--><FONT 
            face=Verdana>
            <P 
align=left>&nbsp;<!--mstheme--></FONT><!--msthemelist--></P></TD></TR><!--msthemelist-->
        <TR>
          <TD vAlign=baseline width=42><IMG height=15 hspace=13 
            src="Corrections ben gan moreau_files/zerbul1a.gif" width=15></TD>
          <TD vAlign=top width="100%"><!--mstheme--><FONT face=Verdana>
            <P align=left>Step 3. Let Result = Input1 LEFT OUTER JOIN Input2. 
            </P>
            <P align=left>A LEFT OUTER JOIN returns: all matching rows between 
            the two inputs, and also, all rows from the left input that don’t 
            have matches in the right input, with NULLs in the columns of the 
            right input. Since there are no matching rows between Input1 and 
            Input2, all of the rows from Input1 are returned, with NULLs in the 
            columns of Input2. </P>
            <P align=left>&nbsp;</P><!--mstheme--></FONT>
            <TABLE borderColorDark=#666666 borderColorLight=#cccccc border=1>
              <TBODY>
              <TR>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptno<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptname<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>empid<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>empname<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptno<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>jobid<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>salary<!--mstheme--></FONT></P></TH></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>100<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Engineering<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>200<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Production<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>300<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Sanitation<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>400<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Management<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P 
align=left>NULL<!--mstheme--></FONT></P></TD></TR></TBODY></TABLE><!--mstheme--><FONT 
            face=Verdana>
            <P 
align=left>&nbsp;<!--mstheme--></FONT><!--msthemelist--></P></TD></TR><!--msthemelist--></TBODY></TABLE><!--mstheme--><FONT 
      face=Verdana>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Pages 
      25-27<!--mstheme--></FONT></H4>
      <P align=left>In the steps that explain the result shown in Table 1-18 of 
      the query shown in Listing 1-27, Input1 refers to the Employees table and 
      Input2 refers to the Departments table. Instead, Input1 should refer to 
      the Departments table and Input2 should refer to the Employees table. The 
      correct steps are: </P><!--mstheme--></FONT><!--msthemelist-->
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0><!--msthemelist-->
        <TBODY>
        <TR>
          <TD vAlign=baseline width=42><IMG height=15 hspace=13 
            src="Corrections ben gan moreau_files/zerbul1a.gif" width=15></TD>
          <TD vAlign=top width="100%"><!--mstheme--><FONT face=Verdana>
            <P align=left>Step 1. Let Input1 = all rows from Departments. </P>
            <P align=left>&nbsp;</P><!--mstheme--></FONT>
            <TABLE borderColorDark=#666666 borderColorLight=#cccccc border=1>
              <TBODY>
              <TR>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptno<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptname<!--mstheme--></FONT></P></TH></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>100<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Engineering <!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>200<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Production<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>300<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Sanitation<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>400<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P 
            align=left>Management<!--mstheme--></FONT></P></TD></TR></TBODY></TABLE><!--mstheme--><FONT 
            face=Verdana>
            <P 
align=left>&nbsp;<!--mstheme--></FONT><!--msthemelist--></P></TD></TR><!--msthemelist-->
        <TR>
          <TD vAlign=baseline width=42><IMG height=15 hspace=13 
            src="Corrections ben gan moreau_files/zerbul1a.gif" width=15></TD>
          <TD vAlign=top width="100%"><!--mstheme--><FONT face=Verdana>
            <P align=left>Step 2. Let Input2 = all rows from Employees. </P>
            <P align=left>&nbsp;</P><!--mstheme--></FONT>
            <TABLE borderColorDark=#666666 borderColorLight=#cccccc border=1>
              <TBODY>
              <TR>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>empid<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>empname<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptno<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>jobid<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>salary<!--mstheme--></FONT></P></TH></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>1<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Leo<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>400<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>30<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>10000.00<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>2<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>George<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>200<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>20<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>1000.00<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>3<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Chris<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>100<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>10<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>2000.00<!--mstheme--></FONT></P></TD></TR>
              <TR></FONT></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>4<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Rob<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>400<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>30<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>3000.00<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>5<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Laura<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>400<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>30<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>3000.00<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>6<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Jeffrey<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>30<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P 
            align=left>5000.00<!--mstheme--></FONT></P></TD></TR></TBODY></TABLE><!--mstheme--><FONT 
            face=Verdana>
            <P 
align=left>&nbsp;<!--mstheme--></FONT><!--msthemelist--></P></TD></TR><!--msthemelist-->
        <TR>
          <TD vAlign=baseline width=42><IMG height=15 hspace=13 
            src="Corrections ben gan moreau_files/zerbul1a.gif" width=15></TD>
          <TD vAlign=top width="100%"><!--mstheme--><FONT face=Verdana>
            <P align=left>Step 3. Let Input3 = Input1 LEFT OUTER JOIN Input2. 
            </P>
            <P align=left>&nbsp;</P><!--mstheme--></FONT>
            <TABLE borderColorDark=#666666 borderColorLight=#cccccc border=1>
              <TBODY>
              <TR>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptno<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptname<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>empid<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>empname<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptno<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>jobid<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>salary<!--mstheme--></FONT></P></TH></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>100<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Engineering<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>3<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Chris<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>100<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>10<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>2000.00<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>200<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Production<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>2<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>George<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>200<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>20<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>1000.00<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>300<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Sanitation<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>400<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Management<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>1<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Leo<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>400<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>30<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>10000.00<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>400<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Management<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>4<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Rob<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>400<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>30<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>3000.00<!--mstheme--></FONT></P></TD></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>400<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Management<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>5<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Laura<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>400<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>30<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P 
            align=left>3000.00<!--mstheme--></FONT></P></TD></TR></TBODY></TABLE><!--mstheme--><FONT 
            face=Verdana>
            <P 
align=left>&nbsp;<!--mstheme--></FONT><!--msthemelist--></P></TD></TR><!--msthemelist-->
        <TR>
          <TD vAlign=baseline width=42><IMG height=15 hspace=13 
            src="Corrections ben gan moreau_files/zerbul1a.gif" width=15></TD>
          <TD vAlign=top width="100%"><!--mstheme--><FONT face=Verdana>
            <P align=left>Step 4. Let Result = filter Input2—WHERE empid IS 
            NULL. </P>
            <P align=left>&nbsp;</P><!--mstheme--></FONT>
            <TABLE borderColorDark=#666666 borderColorLight=#cccccc border=1>
              <TBODY>
              <TR>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptno<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptname<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>empid<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>empname<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>deptno<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>jobid<!--mstheme--></FONT></P></TH>
                <TH><!--mstheme--><FONT face=Verdana>
                  <P align=left>salary<!--mstheme--></FONT></P></TH></TR>
              <TR>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>300<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>Sanitation<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P align=left>NULL<!--mstheme--></FONT></P></TD>
                <TD><!--mstheme--><FONT face=Verdana>
                  <P 
align=left>NULL<!--mstheme--></FONT></P></TD></TR></TBODY></TABLE><!--mstheme--><FONT 
            face=Verdana>
            <P 
align=left>&nbsp;<!--mstheme--></FONT><!--msthemelist--></P></TD></TR><!--msthemelist--></TBODY></TABLE><!--mstheme--><FONT 
      face=Verdana>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      37<!--mstheme--></FONT></H4>
      <P align=left>Last sentence in paragraph after Listing 1-40. "You can also 
      use the table qualifier after the first DELETE clause" Should be: "You can 
      also use the table qualifier after the first FROM clause" </P>
      <H3 align=left><!--mstheme--><FONT color=#6699cc>Chapter 
      2<!--mstheme--></FONT></H3>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      47<!--mstheme--></FONT></H4>
      <P align=left>Last sentence in first paragraph. “…if any y is NULL, then 
      the entire predicate is FALSE, because x &lt;&gt; NULL is FALSE.” Should 
      be: “…if any y is NULL, then the entire predicate is UNKNOWN, because x 
      &lt;&gt; NULL is UNKNOWN. </P>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      54<!--mstheme--></FONT></H4>
      <P align=left>Listing 2-15 in the book contains the following UPDATE 
      statement: </P>
      <DIV align=left><!--mstheme--></FONT><PRE>UPDATE C
  SET F.Owner
FROM
    Feed AS F
  JOIN
    Cars AS C ON C.License = C.License
</PRE><!--mstheme--><FONT face=Verdana></DIV>
      <P align=left>Both the SET clause and the join condition are incorrect. 
      The correct UPDATE statement should look like this: </P>
      <DIV align=left><!--mstheme--></FONT><PRE>UPDATE C
  SET Owner = F.Owner
FROM
    Feed AS F
  JOIN
    Cars AS C ON F.License = C.License
</PRE><!--mstheme--><FONT face=Verdana></DIV>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      63<!--mstheme--></FONT></H4>
      <P align=left>Listing 2-25. The column P.AvgPrice should be replaced with 
      A.AvgPrice. </P>
      <P align=left>Listing 2-26. The WHERE clause “A.CategoryID = A.CategoryID” 
      should be replaced with “A.CategoryID = P.CategoryID”. </P>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      78<!--mstheme--></FONT></H4>
      <P align=left>The following INSERT statement: </P>
      <DIV align=left><!--mstheme--></FONT><PRE>INSERT INTO Users VALUES(1, 'Bruce')</PRE><!--mstheme--><FONT 
      face=Verdana></DIV>
      <P align=left>&nbsp;</P>
      <P align=left>Should be replaced with:<BR>&nbsp;</P>
      <DIV align=left><!--mstheme--></FONT><PRE>INSERT INTO Users VALUES(1, 'BPMargolin')</PRE><!--mstheme--><FONT 
      face=Verdana></DIV>
      <P align=left>&nbsp;</P>
      <P align=left>To comply with the results of the puzzle shown in page 681. 
      </P>
      <H3 align=left><!--mstheme--><FONT color=#6699cc>Chapter 
      4<!--mstheme--></FONT></H3>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      136<!--mstheme--></FONT></H4>
      <P align=left>Third sentence in last paragraph. “One of the bits is used 
      as the sign bit.” This sentence is inaccurate as the format used to store 
      integer values in SQL Server is the twos-complement format and not a 
      format that uses a sign bit. However, positive values have the same bit 
      representation when using a sign bit and when using the twos-complement 
      format, so the discussion that follows still applies. </P>
      <H3 align=left><!--mstheme--><FONT color=#6699cc>Chapter 
      6<!--mstheme--></FONT></H3>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      197<!--mstheme--></FONT></H4>
      <P align=left>Last sentence in third paragraph. “Finally, the IDENTITY 
      properties of tables…” IDENTITY is a column property and not a table 
      property. </P>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      203<!--mstheme--></FONT></H4>
      <P align=left>First sentence in the second paragraph after Listing 6-10. 
      The stored procedure sp_dboption should be replaced with sp_tableoption. 
      </P>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      209<!--mstheme--></FONT></H4>
      <P align=left>Last sentence in page.<BR>"As for the WRITETEXT statement, 
      you need UPDATE permissions on a table in order to use the UPDATE 
      statement." </P>
      <P align=left>Should be:<BR>"As with the WRITETEXT statement, you need 
      UPDATE permissions on a table in order to use the UPDATETEXT statement." 
      </P>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      210<!--mstheme--></FONT></H4>
      <P align=left>Third sentence in the second paragraph under the section 
      “Using the bigint Datatype.” The function BIG_COUNT() should be replaced 
      with COUNT_BIG(). </P>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      216<!--mstheme--></FONT></H4>
      <P align=left>Unbulleted list at top should include datetime. Last 
      sentence in page. The function OBJECTPROPERTY() should be replaced with 
      SQL_VARIANT_PROPERTY(). </P>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      227<!--mstheme--></FONT></H4>
      <P align=left>Last paragraph. “Note that the new_reseed_value changes the 
      current IDENTITY value for the table. Hence, the next inserted value will 
      be new_reseed_value + increment.” The explanation in the book applies if 
      at least one row was inserted into the table since it was created or was 
      last truncated. If no rows have been inserted into the table since it was 
      created or was last truncated, the first row inserted after executing DBCC 
      CHECKIDENT will use new_reseed_value as the identity and not 
      new_reseed_value + increment. </P>
      <H3 align=left><!--mstheme--><FONT color=#6699cc>Chapter 
      9<!--mstheme--></FONT></H3>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      311<!--mstheme--></FONT></H4>
      <P align=left>In Listing 9-12, there should be a comma after the word 
      DEFAULT: </P>
      <DIV align=left><!--mstheme--></FONT><PRE>EXEC usp_DefaultProc
  DEFAULT,
  909,
  50
</PRE><!--mstheme--><FONT face=Verdana></DIV>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      335<!--mstheme--></FONT></H4>
      <P align=left>On page 335, under "Security and Stored Procedures", in the 
      second paragraph about the roles db_datareader, as well as 
      db_denydatareader and db_denydatawriter. The phrase: </P>
      <P align=left>"...those roles to read (INSERT) or write (INSERT, UPDATE, 
      DELETE) data in all tables..." </P>
      <P align=left>Should be: </P>
      <P align=left>"...those roles to read (SELECT) or write (INSERT, UPDATE, 
      DELETE) data in all tables..." </P>
      <P align=left>This occurs twice in the paragraph. </P>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      339<!--mstheme--></FONT></H4>
      <P align=left>Listing 9-51. The comments "-- No existing transaction" and 
      "-- Transaction in progress" should be swapped. </P>
      <H3 align=left><!--mstheme--><FONT color=#6699cc>Chapter 
      10<!--mstheme--></FONT></H3>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      359<!--mstheme--></FONT></H4>
      <P align=left>First sentence on page: Replace the phrase "each table uses" 
      with the phrase "the Child and GrandChild tables use". </P>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>Page 
      365<!--mstheme--></FONT></H4>
      <P align=left>Second bullet: "IDENTITY INSERT" should read 
      "IDENTITY_INSERT". <H3CHAPTER <h4 h3 11< />Pages 404-405 </P>
      <H4 align=left><!--mstheme--><FONT 
      color=#6699cc>&nbsp;<!--mstheme--></FONT></H4>
      <P align=left>Listings 11-46 and 11-48 are supposed to have the recursive 
      and non-recursive implementations of the fibonacci algorithm as UDFs. 
      Currently the functions implement a simple summary of all consecutive 
      integer numbers from zero to n where n is the value provided to the 
      function as an argument. The correct recursive implementation of the 
      fibonacci algorithm is: </P>
      <DIV align=left><!--mstheme--></FONT><PRE>CREATE FUNCTION dbo.fibonacci
(
  @n AS int
)
RETURNS int
AS
BEGIN
  RETURN CASE
    WHEN @n &gt; 1 THEN dbo.fibonacci(@n - 1) + dbo.fibonacci(@n - 2)
    WHEN @n IN (0, 1) THEN @n
    ELSE NULL
  END
END
GO
</PRE><!--mstheme--><FONT face=Verdana></DIV>
      <P align=left>The correct non-recursive implementation of the fibonacci 
      algorithm is: </P>
      <DIV align=left><!--mstheme--></FONT><PRE>CREATE FUNCTION dbo.fibonacci2
(
@n AS int
)
RETURNS int
AS
BEGIN
  IF @n &lt; 0
    RETURN NULL
  ELSE
    IF @n in (0, 1)
      RETURN @n
    ELSE
    BEGIN
      DECLARE
        @i AS int,
        @f1 AS int,
        @f2 AS int,
        @t AS int
      SET @i = 2
      SET @f1 = 0
      SET @f2 = 1
      WHILE @i &lt;= @n
      BEGIN
        SET @t = @f2
        SET @f2 = @f1 + @f2
        SET @f1 = @t
        SET @i = @i + 1
      END 
    END 
  RETURN @f2
END 
GO
</PRE><!--mstheme--><FONT face=Verdana></DIV>
      <H4 align=left><!--mstheme--><FONT color=#6699cc>page 453 Listing 12-17: 
      Calculating Discounts.<!--mstheme--></FONT></H4>
      <DIV align=left><!--mstheme--></FONT><PRE>SELECT
  OrderID,
  Total,
  Previous4,
  CASE
    WHEN Previous4 &lt; 10000.00 THEN 5
    WHEN Previous4 BETWEEN 10000.00 and 15000.00 THEN 10
    ELSE 20
  END AS Discount
FROM
(
  SELECT
    T1.OrderID,
    T1.Total, -- The book reads "T2.Total"
    (
      SELECT
        SUM(T2.Total) AS Total
      FROM 
        #Totals AS T2
      WHERE
          T2.Sequence &gt;= T1.Sequence - 4 -- The book reads "T2.Sequence = T1.Sequence - 4" 
        AND
          T2.Sequence &lt; T1.Sequence
    ) AS Previous4
  FROM
    #Totals AS T1
  WHERE
    0 = T1.Sequence % 5
) AS X
</PRE><!--mstheme--><FONT face=Verdana></DIV>
      <P align=left><H3CHAPTER <h4 h3 16< />Page 606 </P>
      <H4 align=left><!--mstheme--><FONT 
      color=#6699cc>&nbsp;<!--mstheme--></FONT></H4>
      <P align=left>There is a certain problem with the UPDATE trigger, but it 
      isn't related to modifying the manager id to NULL. The problem might 
      appear when you update more than one employee in the same UPDATE statement 
      and at least one employee is a subordinate of another employee. For 
      example, if you issue the following UPDATE statement:</P>
      <DIV align=left><!--mstheme--></FONT><PRE>UPDATE Employees
  SET mgrid = 1
WHERE empid IN(7, 11)
</PRE><!--mstheme--><FONT face=Verdana></DIV>
      <P align=left>David (empid 14) belongs to Robert's (empid 7) subtree. The 
      problem occurs because in the following UPDATE statement within the 
      trigger: </P>
      <DIV align=left><!--mstheme--></FONT><PRE>  UPDATE E
    SET lvl = E.lvl - I.lvl + CASE
                                WHEN I.mgrid IS NULL THEN 0
                                ELSE M.lvl + 1
                              END,
        hierarchy = ISNULL(M.hierarchy, '.') +
                    CAST(I.empid AS varchar(10)) + '.' +
                    right(E.hierarchy, len(E.hierarchy) - len(I.hierarchy))
  FROM
      Employees AS E
    JOIN
      inserted  AS I ON E.hierarchy LIKE I.hierarchy + '%'
    LEFT OUTER JOIN
      Employees AS M ON I.mgrid = M.empid
</PRE><!--mstheme--><FONT face=Verdana></DIV>
      <P align=left>David's row qualifies twice; once as a row in inserted which 
      was directly modified, and another time as a child of Robert. It can be 
      quite complex to write a trigger that handles all kinds of multi-row 
      updates. So, there are a couple of options that you can choose from: </P>
      <P align=left>1. Don't allow multi-row updates. The trigger works fine for 
      single row updates: </P>
      <DIV align=left><!--mstheme--></FONT><PRE>CREATE TRIGGER trg_employees_u_calchierarchy ON Employees FOR UPDATE
AS

-- begin revised part
DECLARE @rc AS int
SET @rc = @@ROWCOUNT

IF @rc = 0
  RETURN

IF @rc &gt; 1
BEGIN
  RAISERROR('Only single row updates are allowed!', 16, 1)
  ROLLBACK TRAN
END
-- end revised part

IF UPDATE(empid)
BEGIN
  RAISERROR('Updates to empid not allowed!', 16, 1)
  ROLLBACK TRAN
END
ELSE IF UPDATE(mgrid)
BEGIN
  UPDATE E
    SET lvl = E.lvl - I.lvl + CASE
                                WHEN I.mgrid IS NULL THEN 0
                                ELSE M.lvl + 1
                              END,
        hierarchy = ISNULL(M.hierarchy, '.') +
                    CAST(I.empid AS varchar(10)) + '.' +
                    right(E.hierarchy, len(E.hierarchy) - len(I.hierarchy))
  FROM
      Employees AS E
    JOIN
      inserted  AS I ON E.hierarchy LIKE I.hierarchy + '%'
    LEFT OUTER JOIN
      Employees AS M ON I.mgrid = M.empid
END
</PRE><!--mstheme--><FONT face=Verdana></DIV>
      <P align=left>2. Only allow multi-row updates that do not modify a parent 
      and a subordinate in the same UPDATE statement. The trigger should be 
      revised as follows:</P>
      <DIV align=left><!--mstheme--></FONT><PRE>CREATE TRIGGER trg_employees_u_calchierarchy ON Employees FOR UPDATE
AS

-- begin revised part
DECLARE @rc AS int
SET @rc = @@ROWCOUNT

IF @rc = 0
  RETURN

IF EXISTS(SELECT *
          FROM
              inserted AS E
            JOIN
              inserted AS M ON E.hierarchy LIKE M.hierarchy + '_%')
BEGIN
  RAISERROR('Updates to an employee and his/her subordinates are not
allowed!', 16, 1)
  ROLLBACK TRAN
END
-- end revised part

IF UPDATE(empid)
BEGIN
  RAISERROR('Updates to empid not allowed!', 16, 1)
  ROLLBACK TRAN
END
ELSE IF UPDATE(mgrid)
BEGIN
  UPDATE E
    SET lvl = E.lvl - I.lvl + CASE
                                WHEN I.mgrid IS NULL THEN 0
                                ELSE M.lvl + 1
                              END,
        hierarchy = ISNULL(M.hierarchy, '.') +
                    CAST(I.empid AS varchar(10)) + '.' +
                    right(E.hierarchy, len(E.hierarchy) - len(I.hierarchy))
  FROM
      Employees AS E
    JOIN
      inserted  AS I ON E.hierarchy LIKE I.hierarchy + '%'
    LEFT OUTER JOIN
      Employees AS M ON I.mgrid = M.empid
END
</PRE><!--mstheme--><FONT face=Verdana></DIV>
      <P align=left>After implementing the above trigger, the following UPDATE 
      should be successful: </P>
      <DIV align=left><!--mstheme--></FONT><PRE>UPDATE employees
  SET mgrid = 1
WHERE empid IN(2, 3)
</PRE><!--mstheme--><FONT face=Verdana></DIV>
      <P align=left>And the following shouldn't:</P>
      <DIV align=left><!--mstheme--></FONT><PRE>UPDATE employees
  SET mgrid = 1
WHERE empid IN(3, 7)
</PRE><!--mstheme--><FONT face=Verdana></DIV>
      <H3 align=left><!--mstheme--><FONT color=#6699cc>Thank 
      you<!--mstheme--></FONT></H3>
      <P align=left>We would like to express our sincere gratitude to the 
      following people who sent us comments and corrections to the book:<BR>BP 
      Margolin<BR>Dejan Sarka<BR>&nbsp;</P>
      <H3 align=left><!--mstheme--><FONT color=#6699cc>Contact 
      us<!--mstheme--></FONT></H3>
      <P align=left>If you have any comments or corrections we will be glad to 
      hear from you. You can contact us through the following e-mail 
      addresses:<BR>Itzik Ben-Gan: <A 
      href="mailto:itzikb@hi-tech.co.il">mailto:itzikb@hi-tech.co.il</A><BR>Tom 
      Moreau: <A href="mailto:tom@cips.ca">tom@cips.ca</A></P><!--msthemeseparator-->
      <P align=center><IMG height=10 
      src="Corrections ben gan moreau_files/zerrulea.gif" width=600></P></SPAN><!--mstheme--></FONT><!--msnavigation--></TD></TR><!--msnavigation--></TBODY></TABLE><!--msnavigation-->
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD><!--mstheme--><FONT face=Verdana>
      <P>&nbsp;</P>
      <P><NOBR>[&nbsp;<A href="http://www.sql.co.il/">Home</A>&nbsp;]</NOBR> 
      <NOBR>[&nbsp;<A 
      href="http://www.sql.co.il/about.htm">About</A>&nbsp;]</NOBR> 
      <NOBR>[&nbsp;<A 
      href="http://www.solidqualitylearning.com/">SolidQualityLearning</A>&nbsp;]</NOBR> 
      <NOBR>[&nbsp;<A 
      href="http://www.sql.co.il/schedule.htm">Schedule</A>&nbsp;]</NOBR> 
      <NOBR>[&nbsp;<A 
      href="http://www.sql.co.il/magazines.htm">Magazines</A>&nbsp;]</NOBR> 
      <NOBR>[&nbsp;<A 
      href="http://www.sql.co.il/books/advtsql/Advanced%20T-SQL%20for%20SQL%20Server%202000.htm">T-SQL&nbsp;Book</A>&nbsp;]</NOBR> 
      <NOBR>[&nbsp;<A 
      href="http://www.sql.co.il/ug/index.htm">ISQL&nbsp;Users&nbsp;Group</A>&nbsp;]</NOBR> 
      <NOBR>[&nbsp;<A 
      href="http://www.sql.co.il/resources/resources.htm">Resources</A>&nbsp;]</NOBR></P>
      <H5><!--mstheme--><FONT color=#6699cc><FONT color=#639ace 
      size=2><B>Contact</B></FONT>: <A 
      href="mailto:itzik@solidqualitylearning.com"><FONT color=#ffffff>Itzik 
      Ben-Gan</FONT></A><FONT color=#ffffff> </FONT><!--mstheme--></FONT></H5>
      <H5><!--mstheme--><FONT color=#6699cc><FONT color=#639ace size=2><B>Last 
      modified: 04/04/03 
      </B></FONT><!--mstheme--></FONT></H5><!--mstheme--></FONT></TD></TR><!--msnavigation--></TBODY></TABLE></BODY></HTML>
